# Cosmos Instrument Layer — Prompt 3

## Что добавлено

### Статусы планет (MVP)
Для каждой планеты считаются 3 статуса из уже существующих данных состояния:

- `freshness` (свежесть): берётся из `state.islands[id].progress.lastRunAt`.
  - чем старее запуск, тем выше срочность обновления;
  - при отсутствии запуска — максимальная срочность.
- `risk` (риск): берётся из `state.islands[id].lastReport`.
  - используется комбинация `score` и наличия `insights[].severity === 'risk'`;
  - если отчёта нет — риск считается нейтральным.
- `confidence` (уверенность):
  - основной источник: `lastReport.confidence`;
  - если отчёта нет, но есть введённые данные (`input`) — используется косвенная оценка полноты (базовый уровень);
  - если нет ни отчёта, ни ввода — `NO DATA`.

### Визуализация
- Badge рядом с планетой:
  - `OK` — есть данные и риск не критичный;
  - `RISK` — есть данные и выраженный риск;
  - `NO DATA` — отчёта нет.
- Halo вокруг планеты:
  - в MVP halo трактуется как **турбулентность**;
  - интенсивность halo увеличивается при росте риска / снижении уверенности.

### Важные планеты
Топ-7 планет выбираются динамически по комбинированному приоритету:
- `risk` + `freshness` + `proximity` (близость к центру как фактор срочности).

Если данных недостаточно, используется fallback к статическому набору из 7 планет.

## Legend toggles
В Cosmos добавлены переключатели:
- «Показывать все подписи»
- «Показывать только важные»
- «Показывать halo (турбулентность)»

Состояние переключателей сохраняется в существующем `store.flags`:
- `cosmosShowAllLabels`
- `cosmosOnlyImportant`
- `cosmosShowHalo`

## Доступность
- Выбранная планета визуально усилена (halo + контур).
- Навигация с клавиатуры на desktop:
  - `Tab` — фокус по планетам;
  - `Enter` / `Space` — открытие меню планеты.

## Fix onboarding overlay
- Overlay теперь обрабатывает pointer events только в активном состоянии.
- В скрытом/неактивном состоянии слой не перехватывает события карты (`pointer-events: none`).
- Кнопка «Пропустить» используется как явное закрытие onboarding.

## Что остаётся на Prompt 4
- Тонкая калибровка весов приоритизации (risk/freshness/proximity) на реальных сценариях.
- Расширение объяснимости: тултипы с расшифровкой конкретного сигнала на планете.
- Дополнительные accessibility-улучшения (например, единый live-region для статуса выбора).
